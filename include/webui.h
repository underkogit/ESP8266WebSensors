
 
 
const char* htmlContentWebui = R"rawliteral(
<!DOCTYPE html><html lang=ru><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><aside class=sidebar><div id=sensor-sidebar aria-live=polite></div></aside> <script>function createElementA(n,t,i){const r=document.createElement(n);return r.className=t,r.textContent=i,r}function renderSidebar(n,t){const i=document.getElementById(n);i&&(i.innerHTML="",Object.entries(t).forEach(([n,t])=>{const r=document.createElement("section");r.className="sensor";const u=document.createElement("div");u.className="sensor-header";u.appendChild(createElementA("div","sensor-name",n));u.appendChild(createElementA("div","sensor-meta",Object.keys(t).length+" параметр(ы)"));r.appendChild(u);Object.entries(t).forEach(([n,t])=>{const i=document.createElement("div");i.className="param";i.appendChild(createElementA("div","param-value",t&&typeof t.value=="number"?`${formatNumber(t.value)} ${t.unit||""}`:"-"));i.appendChild(createElementA("div","param-name",n));r.appendChild(i)});i.appendChild(r)}))}function formatNumber(n){return(Math.round(n*100)/100).toLocaleString("ru-RU",{maximumFractionDigits:2})}async function pingRangeParallel(n,t){const r="192.168.0.",i=parseInt(n.split(".").pop()),u=parseInt(t.split(".").pop()),f=Array.from({length:u-i+1},(n,t)=>`${r}${i+t}`),e=f.map(n=>fetch(`http://${n}/api/ping`,{timeout:2e3}).then(t=>t.ok?{ip:n,status:!0}:{ip:n,status:!1}).catch(()=>({ip:n,status:!1}))),o=await Promise.allSettled(e);return o.filter(n=>n.status==="fulfilled"&&n.value.status).map(n=>n.value)}function fetchWithTimeout(n,t=REQUEST_TIMEOUT_MS){const i=new AbortController,r=setTimeout(()=>i.abort(),t);return fetch(n,{signal:i.signal}).finally(()=>clearTimeout(r))}async function pollOnce(){if(!isFetching){isFetching=!0;try{const n=await fetchWithTimeout(API_URL);if(!n.ok)throw new Error("HTTP "+n.status);const t=await n.json();renderSidebar("sensor-sidebar",t)}catch(n){const t=document.getElementById("sensor-sidebar");t&&(t.innerHTML=`<div class="sensor"><div class="sensor-header"><div class="sensor-name">Ошибка</div><div class="sensor-meta">${n.message}</div></div></div>`);console.error("Poll error:",n)}finally{isFetching=!1}}}function startPolling(){pingRangeParallel("192.168.0.100","192.168.0.130").then(n=>{host="http://"+n.map(n=>n.ip)[0],API_URL=host+"/api/sensors",console.log(host)});pollOnce();pollingHandle=setInterval(pollOnce,POLL_INTERVAL_MS)}function stopPolling(){pollingHandle&&(clearInterval(pollingHandle),pollingHandle=null)}let host="http://192.168.0.100",API_URL=host+"/api/sensors",pollingHandle=null,isFetching=!1;const POLL_INTERVAL_MS=1e3,REQUEST_TIMEOUT_MS=800;document.addEventListener("DOMContentLoaded",()=>{renderSidebar("sensor-sidebar",{}),startPolling(),window.sensorChart=initChart(),window.addEventListener("beforeunload",stopPolling)})</script><style>:root{--bg:#191919;--panel:#0b1220;--card:#0f2433;--accent:#2dd4bf;--muted:#94a3b8;--text:#e6eef6;--glass:rgba(255,255,255,.04)} body{height:100%;margin:0;font-family:Inter,Roboto,system-ui,-apple-system,"Segoe UI","Helvetica Neue",Arial} body{background:var(--bg);color:var(--text);display:flex;align-items:stretch;padding:24px} .page-title{margin:0;font-size:18px;color:var(--muted)} .chart-section{width:100%;overflow:hidden} .sidebar{padding:16px;margin:12px;width:calc(100% - 24px);max-width:none} chart-container{margin:12px;width:calc(100% - 24px);max-width:none} sensor-chart{filter:brightness(.95)} .sidebar{position:fixed;right:18px;top:18px;width:300px;max-width:calc(100% - 36px);backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.04);border-radius:12px;padding:12px;box-shadow:0 6px 24px rgba(2,6,23,.6)} .sensor{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,.01),rgba(255,255,255,.015));margin-bottom:10px;border:1px solid rgba(255,255,255,.02)} .sensor:last-child{margin-bottom:0} .sensor-header{display:flex;justify-content:space-between;align-items:center;gap:8px} .sensor-name{font-weight:600;color:var(--text);font-size:14px;text-transform:uppercase;letter-spacing:.6px} .sensor-meta{font-size:12px;color:var(--muted)} .param{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:linear-gradient(90deg,rgba(255,255,255,.01),rgba(255,255,255,.005));border:1px solid rgba(255,255,255,.02)} .param-name{font-size:13px;color:var(--muted)} .param-value{font-weight:700;color:var(--accent);font-size:14px}</style>
)rawliteral";
 
