
#ifndef WEBUI_H
#define WEBUI_H
const char* htmlContentWebui = R"rawliteral(
<!DOCTYPE html><html lang=ru><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><main></main><aside class=sidebar id=sensor-sidebar aria-live=polite></aside> <script>function formatNumber(n){return(Math.round(n*100)/100).toLocaleString("ru-RU",{maximumFractionDigits:2})}async function pingRange(n,t){const r=parseInt(n.split(".").pop()),u=parseInt(t.split(".").pop()),i=[];for(let n=r;n<=u;n++){const t=`http://192.168.0.${n}/api/ping`,r=fetch(t).then(t=>t.ok?t.json().then(t=>({ip:`192.168.0.${n}`,status:!!t.status})):{ip:`192.168.0.${n}`,status:!1}).catch(()=>({ip:`192.168.0.${n}`,status:!1}));i.push(r)}const f=await Promise.all(i);return f.filter(n=>n.status===!0)}function renderSidebar(n,t){const i=document.getElementById(n);i&&(i.innerHTML="",Object.entries(t).forEach(([n,t])=>{const r=document.createElement("section");r.className="sensor";const u=document.createElement("div");u.className="sensor-header";const f=document.createElement("div");f.className="sensor-name";f.textContent=n;const e=document.createElement("div");e.className="sensor-meta";e.textContent=Object.keys(t).length+" параметр(ы)";u.appendChild(f);u.appendChild(e);r.appendChild(u);Object.entries(t).forEach(([n,t])=>{const i=document.createElement("div");i.className="param";const u=document.createElement("div");u.className="param-name";u.textContent=n;const f=document.createElement("div");f.className="param-value";f.textContent=t&&typeof t.value=="number"?`${formatNumber(t.value)} ${t.unit||""}`:"-";i.appendChild(u);i.appendChild(f);r.appendChild(i)});i.appendChild(r)}))}function fetchWithTimeout(n,t=REQUEST_TIMEOUT_MS){const i=new AbortController,r=setTimeout(()=>i.abort(),t);return fetch(n,{signal:i.signal}).finally(()=>clearTimeout(r))}async function pollOnce(){if(!isFetching){isFetching=!0;try{const n=await fetchWithTimeout(API_URL);if(!n.ok)throw new Error("HTTP "+n.status);const t=await n.json();renderSidebar("sensor-sidebar",t)}catch(n){const t=document.getElementById("sensor-sidebar");t&&(t.innerHTML=`<div class="sensor"><div class="sensor-header"><div class="sensor-name">Ошибка</div><div class="sensor-meta">${n.message}</div></div></div>`);console.error("Poll error:",n)}finally{isFetching=!1}}}function startPolling(){pollOnce();pingRange("192.168.0.100","192.168.0.130").then(n=>{host="http://"+n.map(n=>n.ip)[0],API_URL=host+"/api/sensors",console.log("",host)});pollingHandle=setInterval(pollOnce,POLL_INTERVAL_MS)}function stopPolling(){pollingHandle&&(clearInterval(pollingHandle),pollingHandle=null)}let host="http://192.168.0.100",API_URL=host+"/api/sensors";const POLL_INTERVAL_MS=1e3,REQUEST_TIMEOUT_MS=800;let pollingHandle=null,isFetching=!1;document.addEventListener("DOMContentLoaded",()=>{renderSidebar("sensor-sidebar",{}),startPolling(),window.addEventListener("beforeunload",stopPolling)})</script><style>:root{--bg:#191919;--panel:#0b1220;--card:#0f2433;--accent:#2dd4bf;--muted:#94a3b8;--text:#e6eef6;--glass:rgba(255,255,255,.04)} body{height:100%;margin:0;font-family:Inter,Roboto,system-ui,-apple-system,"Segoe UI","Helvetica Neue",Arial} body{background:var(--bg);color:var(--text);display:flex;align-items:stretch;padding:24px} .page-title{margin:0;font-size:18px;color:var(--muted)} .sidebar{position:fixed;right:18px;top:18px;width:300px;max-width:calc(100% - 36px);backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.04);border-radius:12px;padding:12px;box-shadow:0 6px 24px rgba(2,6,23,.6)} .sensor{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,.01),rgba(255,255,255,.015));margin-bottom:10px;border:1px solid rgba(255,255,255,.02)} .sensor:last-child{margin-bottom:0} .sensor-header{display:flex;justify-content:space-between;align-items:center;gap:8px} .sensor-name{font-weight:600;color:var(--text);font-size:14px;text-transform:uppercase;letter-spacing:.6px} .sensor-meta{font-size:12px;color:var(--muted)} .param{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:linear-gradient(90deg,rgba(255,255,255,.01),rgba(255,255,255,.005));border:1px solid rgba(255,255,255,.02)} .param-name{font-size:13px;color:var(--muted)} .param-value{font-weight:700;color:var(--accent);font-size:14px}</style>
)rawliteral";
#endif
